<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API –û–±—ä—è–≤–ª–µ–Ω–∏–π</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        h2 {
            color: #666;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        .api-section {
            margin-bottom: 30px;
        }
        .endpoint {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
        }
        .method {
            font-weight: bold;
            color: #007bff;
        }
        .url {
            font-family: monospace;
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
        }
        .description {
            color: #666;
            margin-top: 5px;
        }
        .response {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn-success {
            background: #28a745;
        }
        .btn-success:hover {
            background: #1e7e34;
        }
        .btn-danger {
            background: #dc3545;
        }
        .btn-danger:hover {
            background: #c82333;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <h1>üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API –°–µ—Ä–≤–∏—Å–∞ –û–±—ä—è–≤–ª–µ–Ω–∏–π</h1>
    
    <div class="container">
        <h2>üìä –°—Ç–∞—Ç—É—Å API</h2>
        <button class="btn" onclick="testAPI()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å API</button>
        <div id="status" class="response"></div>
    </div>

    <div class="grid">
        <div class="container">
            <h2>üìã –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
            <div class="api-section">
                <div class="endpoint">
                    <div class="method">GET</div>
                    <div class="url">/api/categories/</div>
                    <div class="description">–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π</div>
                    <button class="btn btn-success" onclick="getCategories()">–ü–æ–ª—É—á–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</button>
                    <div id="categories" class="response"></div>
                </div>
            </div>
        </div>

        <div class="container">
            <h2>üìù –û–±—ä—è–≤–ª–µ–Ω–∏—è</h2>
            <div class="api-section">
                <div class="endpoint">
                    <div class="method">GET</div>
                    <div class="url">/api/advertisements/</div>
                    <div class="description">–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π</div>
                    <button class="btn btn-success" onclick="getAdvertisements()">–ü–æ–ª—É—á–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è</button>
                    <div id="advertisements" class="response"></div>
                </div>

                <div class="endpoint">
                    <div class="method">POST</div>
                    <div class="url">/api/advertisements/</div>
                    <div class="description">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</div>
                    
                    <div class="form-group">
                        <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫:</label>
                        <input type="text" id="title" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫">
                    </div>
                    <div class="form-group">
                        <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                        <textarea id="description" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ"></textarea>
                    </div>
                    <div class="form-group">
                        <label>–¶–µ–Ω–∞:</label>
                        <input type="number" id="price" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É">
                    </div>
                    <div class="form-group">
                        <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                        <select id="category">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</label>
                        <input type="text" id="location" placeholder="–í–≤–µ–¥–∏—Ç–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ">
                    </div>
                    
                    <button class="btn btn-success" onclick="createAdvertisement()">–°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</button>
                    <div id="create-result" class="response"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <h2>üîç –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è</h2>
        <div class="api-section">
            <div class="form-group">
                <label>–ü–æ–∏—Å–∫:</label>
                <input type="text" id="search" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å">
                <button class="btn" onclick="searchAdvertisements()">–ü–æ–∏—Å–∫</button>
            </div>
            <div class="form-group">
                <label>–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞:</label>
                <input type="number" id="min-price" placeholder="–ú–∏–Ω. —Ü–µ–Ω–∞">
                <label>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞:</label>
                <input type="number" id="max-price" placeholder="–ú–∞–∫—Å. —Ü–µ–Ω–∞">
                <button class="btn" onclick="filterByPrice()">–§–∏–ª—å—Ç—Ä –ø–æ —Ü–µ–Ω–µ</button>
            </div>
            <div id="search-results" class="response"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api';

        // –ü–æ–ª—É—á–∏—Ç—å CSRF —Ç–æ–∫–µ–Ω
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å API
        async function testAPI() {
            try {
                const response = await fetch(`${API_BASE}/categories/`);
                const data = await response.json();
                document.getElementById('status').textContent = 
                    `‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç! –ü–æ–ª—É—á–µ–Ω–æ ${data.length} –∫–∞—Ç–µ–≥–æ—Ä–∏–π`;
            } catch (error) {
                document.getElementById('status').textContent = 
                    `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        // –ü–æ–ª—É—á–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        async function getCategories() {
            try {
                const response = await fetch(`${API_BASE}/categories/`);
                const data = await response.json();
                document.getElementById('categories').textContent = 
                    JSON.stringify(data, null, 2);
                
                // –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Å–µ–ª–µ–∫—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π
                const select = document.getElementById('category');
                select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>';
                data.forEach(cat => {
                    select.innerHTML += `<option value="${cat.id}">${cat.name}</option>`;
                });
            } catch (error) {
                document.getElementById('categories').textContent = 
                    `–û—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        // –ü–æ–ª—É—á–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è
        async function getAdvertisements() {
            try {
                const response = await fetch(`${API_BASE}/advertisements/`);
                const data = await response.json();
                document.getElementById('advertisements').textContent = 
                    JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('advertisements').textContent = 
                    `–û—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        // –°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
        async function createAdvertisement() {
            const data = {
                title: document.getElementById('title').value,
                description: document.getElementById('description').value,
                price: parseFloat(document.getElementById('price').value),
                category: parseInt(document.getElementById('category').value),
                location: document.getElementById('location').value
            };

            try {
                const response = await fetch(`${API_BASE}/advertisements/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    const result = await response.json();
                    document.getElementById('create-result').textContent = 
                        `‚úÖ –û–±—ä—è–≤–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ!\n${JSON.stringify(result, null, 2)}`;
                } else {
                    const error = await response.json();
                    document.getElementById('create-result').textContent = 
                        `‚ùå –û—à–∏–±–∫–∞: ${JSON.stringify(error, null, 2)}`;
                }
            } catch (error) {
                document.getElementById('create-result').textContent = 
                    `–û—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        // –ü–æ–∏—Å–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π
        async function searchAdvertisements() {
            const query = document.getElementById('search').value;
            try {
                const response = await fetch(`${API_BASE}/advertisements/?search=${encodeURIComponent(query)}`);
                const data = await response.json();
                document.getElementById('search-results').textContent = 
                    JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('search-results').textContent = 
                    `–û—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        // –§–∏–ª—å—Ç—Ä –ø–æ —Ü–µ–Ω–µ
        async function filterByPrice() {
            const minPrice = document.getElementById('min-price').value;
            const maxPrice = document.getElementById('max-price').value;
            
            let url = `${API_BASE}/advertisements/`;
            const params = [];
            
            if (minPrice) params.push(`min_price=${minPrice}`);
            if (maxPrice) params.push(`max_price=${maxPrice}`);
            
            if (params.length > 0) {
                url += '?' + params.join('&');
            }

            try {
                const response = await fetch(url);
                const data = await response.json();
                document.getElementById('search-results').textContent = 
                    JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('search-results').textContent = 
                    `–û—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            testAPI();
            getCategories();
        };
    </script>
</body>
</html>
